<div id="rpm416-visualization-container">
  <style>
    .rpm416-button {
      margin-top: 5px;
      margin-bottom: 5px;
    }

    .rpm416-container {
      background-color: #c6d3d3;
    }

    .rpm416-header {
      font-size: medium;
      font-weight: bold;
      text-align: center;
      margin-top: -1px;
      margin-bottom: -1px;
    }

    .rpm416-group {
      margin-top: 8px;
      margin-bottom: 8px;
    }

    .rpm416-text-key {
      color: #990c9e;
    }

    .rpm416-text-value {
      color: #046ffd;
    }

    .rpm416-text-value-right-inline {
      width: 15%;
      display: inline-block;
      text-align: right;
    }

    .rpm416-text-unit {
      color: #769ca6;
    }

    .rpm416-valuebar {
      height: 8px;
      background-color: #9a9a9a;
      display: inline-block;
    }

    .rpm416-valuebar-inner {
      height: 100%;
      width: 0%;
      float: left;
    }

    .rpm416-valuebar-short {
      width: 60%;
    }

    .rpm416-valuebar-long {
      width: 90%;
    }

    .rpm416-grouping-table {
      width: 100%;
      margin-top: 10px;
    }

    .rpm416-grouping-table td {
      border: #aeaeae 1px solid;
      padding-left: 10px;
      padding-right: 10px;
      width: 48%;
    }

    .rpm416-td-leftalign {
      text-align: left;
    }

    .rpm416-inner-table td {
      border: none;
    }

    .rpm416-group-phase-1 {
      border: #e8b20a 2px solid;
      padding: 5px;
    }

    .rpm416-color-phase-1 {
      color: #e8b20a;
    }

    .rpm416-group-phase-2 {
      border: #1a8e08 2px solid;
      padding: 5px;
    }

    .rpm416-color-phase-2 {
      color: #1a8e08;
    }

    .rpm416-group-phase-3 {
      border: #ed210f 2px solid;
      padding: 5px;
    }

    .rpm416-color-phase-3 {
      color: #ed210f;
    }

    .rpm416-group-three-phase {
      border: #8663a9 2px solid;
      padding: 5px;
    }

    .rpm416-color-three-phase {
      color: #8663a9;
    }

    .rpm416-status-indicator {
      display: inline-block;
      height: 1em;
      width: 1em;
      border-radius: 50%;
      margin-left: 0.25em;
      margin-right: 0.25em;
    }

    #rpm416-errorlist-table {
      width: 100%;
    }

    #rpm416-errorlist-table thead tr {
      height: 1.5em;
    }

    #rpm416-errorlist-table tbody {
      background-color: transparent;
      max-height: 100%;
      min-width: 100%;
    }

    #rpm416-errorlist-table th {
      text-align: center;
      padding: 4px;
      border: 3px solid transparent;
      background-color: whitesmoke;
      height: 1.5em;
      position: sticky;
      top: 0;
    }

    #rpm416-errorlist-table td {
      height: 1.5em;
      text-align: center;
      padding: 4px;
      border: 3px solid transparent;
    }

    #rpm416-substrate {
      position: absolute;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      z-index: 50;
      background-color: #1c1c1c7f;
      display: none;
    }

    .rpm416-popup-menu {
      padding: 5px;
      position: absolute;
      left: 25%;
      top: 15%;
      min-width: 450px;
      width: 50%;
      z-index: 100;
      background-color: whitesmoke;
      display: none;
      text-align: left;
    }

    #rpm416-graph-table td {
      padding: 5px;
    }
  </style>

  <div id="rpm416-html-container">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <div class="container rpm416-container">
      <div class="row">
        <div class="col" style="text-align: left;">
          <button type="button" class="btn btn-primary btn-sm rpm416-button" id="rpm416-button-view">View</button>
        </div>
      </div>
      <div class="row">
        <div class="col-sm">
          <div class="rpm416-group rpm416-group-phase-1">
            <header class="rpm416-header rpm416-color-phase-1">Phase 1 (Group)</header>
            <table class="rpm416-grouping-table">
              <tbody>
                <tr>
                  <td class="rpm416-td-leftalign">
                    <div>Voltage (channel 1)</div>

                    <div>
                      <div class="rpm416-valuebar rpm416-valuebar-short" value="0">
                        <div class="valuevar-inner bg-success"></div>
                      </div>
                      <span class="rpm416-text-value rpm416-text-value-right-inline" id="rpm416-voltage-rms-1">0</span>
                      <span class="rpm416-text-unit">V</span>
                    </div>

                    <div>
                      <span class="rpm416-text-key">THDr:</span>
                      <span class="rpm416-text-value rpm416-text-value-right-inline" id="rpm416-voltage-thdr-1">0</span>
                      <span class="rpm416-text-unit">%</span>
                      <span class="rpm416-text-key">Frequency:</span>
                      <span class="rpm416-text-value rpm416-text-value-right-inline"
                        id="rpm416-voltage-frequency-1">0</span>
                      <span class="rpm416-text-unit">Hz</span>
                    </div>
                  </td>
                  <td class="rpm416-td-leftalign">
                    <div>Current (channel 4)</div>

                    <div>
                      <div class="rpm416-valuebar rpm416-valuebar-short" value="0">
                        <div class="valuevar-inner bg-success"></div>
                      </div>
                      <span class="rpm416-text-value rpm416-text-value-right-inline" id="rpm416-amperage-rms-1">0</span>
                      <span class="rpm416-text-unit">A</span>
                    </div>

                    <div>
                      <span class="rpm416-text-key">THDr:</span>
                      <span class="rpm416-text-value rpm416-text-value-right-inline"
                        id="rpm416-amperage-thdr-1">0</span>
                      <span class="rpm416-text-unit">%</span>
                      <span class="rpm416-text-key">Frequency:</span>
                      <span class="rpm416-text-value rpm416-text-value-right-inline"
                        id="rpm416-amperage-frequency-1">0</span>
                      <span class="rpm416-text-unit">Hz</span>
                    </div>
                  </td>
                </tr>
                <tr>
                  <td colspan="2" class="rpm416-td-leftalign">
                    Power (channel 16)
                    <div>
                      <span class="rpm416-text-key">Full:</span>
                      <span class="rpm416-text-value rpm416-text-value-right-inline">0</span>
                      <div class="rpm416-valuebar rpm416-valuebar-short" value="0">
                        <div class="valuevar-inner bg-success"></div>
                      </div>
                    </div>
                  </td>
                </tr>
                <tr>
                  <td class="rpm416-td-leftalign">
                    <div>
                      <span class="rpm416-text-key">Active:</span>
                      <span class="rpm416-text-value rpm416-text-value-right-inline">0</span>
                      <span class="rpm416-text-key">Energy:</span>
                      <span class="rpm416-text-value rpm416-text-value-right-inline">0</span>
                    </div>

                    <div class="rpm416-valuebar rpm416-valuebar-long" value="0">
                      <div class="valuevar-inner bg-success"></div>
                    </div>
                  </td>
                  <td class="rpm416-td-leftalign">
                    <div>
                      <span class="rpm416-text-key">Reactive:</span>
                      <span class="rpm416-text-value rpm416-text-value-right-inline">0</span>
                      <span class="rpm416-text-key">Energy:</span>
                      <span class="rpm416-text-value rpm416-text-value-right-inline">0</span>
                    </div>

                    <div class="rpm416-valuebar rpm416-valuebar-long" value="0">
                      <div class="valuevar-inner bg-success"></div>
                    </div>
                  </td>
                </tr>

                <tr>
                  <td colspan="2">
                    <span class="rpm416-text-key">Power ratio:</span>
                    <span class="rpm416-text-value rpm416-text-value-right-inline">0</span>
                  </td>
                </tr>
              </tbody>
            </table>

          </div>
          <div class="rpm416-group rpm416-group-phase-2">
            <header class="rpm416-header rpm416-color-phase-2">Phase 2 (Group)</header>
            <table class="rpm416-grouping-table">
              <tbody>
                <tr>
                  <td class="rpm416-td-leftalign">
                    <div>Voltage (channel 2)</div>

                    <div>
                      <div class="rpm416-valuebar rpm416-valuebar-short" value="0">
                        <div class="valuevar-inner bg-success"></div>
                      </div>
                      <span class="rpm416-text-value rpm416-text-value-right-inline" id="rpm416-voltage-rms-2">0</span>
                      <span class="rpm416-text-unit">V</span>
                    </div>

                    <div>
                      <span class="rpm416-text-key">THDr:</span>
                      <span class="rpm416-text-value rpm416-text-value-right-inline" id="rpm416-voltage-thdr-2">0</span>
                      <span class="rpm416-text-unit">%</span>
                      <span class="rpm416-text-key">Frequency:</span>
                      <span class="rpm416-text-value rpm416-text-value-right-inline"
                        id="rpm416-voltage-frequency-2">0</span>
                      <span class="rpm416-text-unit">Hz</span>
                    </div>
                  </td>
                  <td class="rpm416-td-leftalign">
                    <div>Current (channel 5)</div>

                    <div>
                      <div class="rpm416-valuebar rpm416-valuebar-short" value="0">
                        <div class="valuevar-inner bg-success"></div>
                      </div>
                      <span class="rpm416-text-value rpm416-text-value-right-inline" id="rpm416-amperage-rms-2">0</span>
                      <span class="rpm416-text-unit">A</span>
                    </div>

                    <div>
                      <span class="rpm416-text-key">THDr:</span>
                      <span class="rpm416-text-value rpm416-text-value-right-inline"
                        id="rpm416-amperage-thdr-2">0</span>
                      <span class="rpm416-text-unit">%</span>
                      <span class="rpm416-text-key">Frequency:</span>
                      <span class="rpm416-text-value rpm416-text-value-right-inline"
                        id="rpm416-amperage-frequency-2">0</span>
                      <span class="rpm416-text-unit">Hz</span>
                    </div>
                  </td>
                </tr>
                <tr>
                  <td colspan="2" class="rpm416-td-leftalign">
                    Power (channel 17)
                    <div>
                      <span class="rpm416-text-key">Full:</span>
                      <span class="rpm416-text-value rpm416-text-value-right-inline">0</span>
                      <div class="rpm416-valuebar rpm416-valuebar-short" value="0">
                        <div class="valuevar-inner bg-success"></div>
                      </div>
                    </div>
                  </td>
                </tr>
                <tr>
                  <td class="rpm416-td-leftalign">
                    <div>
                      <span class="rpm416-text-key">Active:</span>
                      <span class="rpm416-text-value rpm416-text-value-right-inline">0</span>
                      <span class="rpm416-text-key">Energy:</span>
                      <span class="rpm416-text-value rpm416-text-value-right-inline">0</span>
                    </div>

                    <div class="rpm416-valuebar rpm416-valuebar-long" value="0">
                      <div class="valuevar-inner bg-success"></div>
                    </div>
                  </td>
                  <td class="rpm416-td-leftalign">
                    <div>
                      <span class="rpm416-text-key">Reactive:</span>
                      <span class="rpm416-text-value rpm416-text-value-right-inline">0</span>
                      <span class="rpm416-text-key">Energy:</span>
                      <span class="rpm416-text-value rpm416-text-value-right-inline">0</span>
                    </div>

                    <div class="rpm416-valuebar rpm416-valuebar-long" value="0">
                      <div class="valuevar-inner bg-success"></div>
                    </div>
                  </td>
                </tr>

                <tr>
                  <td colspan="2">
                    <span class="rpm416-text-key">Power ratio:</span>
                    <span class="rpm416-text-value rpm416-text-value-right-inline">0</span>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="rpm416-group rpm416-group-phase-3">
            <header class="rpm416-header rpm416-color-phase-3">Phase 3 (Group)</header>
            <table class="rpm416-grouping-table">
              <tbody>
                <tr>
                  <td class="rpm416-td-leftalign">
                    <div>Voltage (channel 3)</div>

                    <div>
                      <div class="rpm416-valuebar rpm416-valuebar-short" value="0">
                        <div class="valuevar-inner bg-success"></div>
                      </div>
                      <span class="rpm416-text-value rpm416-text-value-right-inline" id="rpm416-voltage-rms-3">0</span>
                      <span class="rpm416-text-unit">V</span>
                    </div>

                    <div>
                      <span class="rpm416-text-key">THDr:</span>
                      <span class="rpm416-text-value rpm416-text-value-right-inline" id="rpm416-voltage-thdr-3">0</span>
                      <span class="rpm416-text-unit">%</span>
                      <span class="rpm416-text-key">Frequency:</span>
                      <span class="rpm416-text-value rpm416-text-value-right-inline"
                        id="rpm416-voltage-frequency-3">0</span>
                      <span class="rpm416-text-unit">Hz</span>
                    </div>
                  </td>
                  <td class="rpm416-td-leftalign">
                    <div>Current (channel 6)</div>

                    <div>
                      <div class="rpm416-valuebar rpm416-valuebar-short" value="0">
                        <div class="valuevar-inner bg-success"></div>
                      </div>
                      <span class="rpm416-text-value rpm416-text-value-right-inline" id="rpm416-amperage-rms-3">0</span>
                      <span class="rpm416-text-unit">A</span>
                    </div>

                    <div>
                      <span class="rpm416-text-key">THDr:</span>
                      <span class="rpm416-text-value rpm416-text-value-right-inline"
                        id="rpm416-amperage-thdr-3">0</span>
                      <span class="rpm416-text-unit">%</span>
                      <span class="rpm416-text-key">Frequency:</span>
                      <span class="rpm416-text-value rpm416-text-value-right-inline"
                        id="rpm416-amperage-frequency-3">0</span>
                      <span class="rpm416-text-unit">Hz</span>
                    </div>
                  </td>
                </tr>
                <tr>
                  <td colspan="2" class="rpm416-td-leftalign">
                    Power (channel 18)
                    <div>
                      <span class="rpm416-text-key">Full:</span>
                      <span class="rpm416-text-value rpm416-text-value-right-inline">0</span>
                      <div class="rpm416-valuebar rpm416-valuebar-short" value="0">
                        <div class="valuevar-inner bg-success"></div>
                      </div>
                    </div>
                  </td>
                </tr>
                <tr>
                  <td class="rpm416-td-leftalign">
                    <div>
                      <span class="rpm416-text-key">Active:</span>
                      <span class="rpm416-text-value rpm416-text-value-right-inline">0</span>
                      <span class="rpm416-text-key">Energy:</span>
                      <span class="rpm416-text-value rpm416-text-value-right-inline">0</span>
                    </div>

                    <div class="rpm416-valuebar rpm416-valuebar-long" value="0">
                      <div class="valuevar-inner bg-success"></div>
                    </div>
                  </td>
                  <td class="rpm416-td-leftalign">
                    <div>
                      <span class="rpm416-text-key">Reactive:</span>
                      <span class="rpm416-text-value rpm416-text-value-right-inline">0</span>
                      <span class="rpm416-text-key">Energy:</span>
                      <span class="rpm416-text-value rpm416-text-value-right-inline">0</span>
                    </div>

                    <div class="rpm416-valuebar rpm416-valuebar-long" value="0">
                      <div class="valuevar-inner bg-success"></div>
                    </div>
                  </td>
                </tr>

                <tr>
                  <td colspan="2">
                    <span class="rpm416-text-key">Power ratio:</span>
                    <span class="rpm416-text-value rpm416-text-value-right-inline">0</span>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="rpm416-group rpm416-group-three-phase">
            <header class="rpm416-header rpm416-color-three-phase">Three-phase system</header>
            <div class="rpm416-group">
              Line voltage
              <div>
                <span class="rpm416-text-key">AB:</span>
                <div class="rpm416-valuebar rpm416-valuebar-short" value="0">
                  <div class="valuevar-inner bg-success"></div>
                </div>
                <span class="rpm416-text-value rpm416-text-value-right-inline" id="rpm416-voltage-line-ab">0</span>
              </div>
              <div>
                <span class="rpm416-text-key">BC:</span>
                <div class="rpm416-valuebar rpm416-valuebar-short" value="0">
                  <div class="valuevar-inner bg-success"></div>
                </div>
                <span class="rpm416-text-value rpm416-text-value-right-inline" id="rpm416-voltage-line-bc">0</span>
              </div>
              <div>
                <span class="rpm416-text-key">CA:</span>
                <div class="rpm416-valuebar rpm416-valuebar-short" value="0">
                  <div class="valuevar-inner bg-success"></div>
                </div>
                <span class="rpm416-text-value rpm416-text-value-right-inline" id="rpm416-voltage-line-ca">0</span>
              </div>

              <div>
                <span class="rpm416-text-key">Reverse seq-ce:</span>
                <span class="rpm416-text-value rpm416-text-value-right-inline" style="width:10%"
                  id="rpm416-negative-sequence-value">0</span>
                <span class="rpm416-text-unit">V</span>
                <span class="rpm416-text-key">Direct seq-ce:</span>
                <span class="rpm416-text-value rpm416-text-value-right-inline" style="width:10%"
                  id="rpm416-positive-sequence-value">0</span>
                <span class="rpm416-text-unit">V</span>
                <span class="rpm416-text-key">Zero seq-ce:</span>
                <span class="rpm416-text-value rpm416-text-value-right-inline" style="width:10%"
                  id="rpm416-zero-sequence-value">0</span>
                <span class="rpm416-text-unit">V</span>
              </div>
            </div>
          </div>
        </div>
        <div class="col-sm">

          <table class="rpm416-grouping-table">
            <tbody>
              <tr>
                <td class="rpm416-td-leftalign">
                  <div>Analog voltage (Channel 10):</div>
                  <div>
                    <div class="rpm416-valuebar rpm416-valuebar-short" value="0">
                      <div class="valuevar-inner bg-success"></div>
                    </div>
                    <span class="rpm416-text-value rpm416-text-value-right-inline" id="rpm416-analog-voltage">0</span>
                  </div>
                  <div>
                    <span class="rpm416-text-key">User scale:</span>
                    <span class="rpm416-text-value rpm416-text-value-right-inline"
                      id="rpm416-analog-voltage-userscale">0</span>
                  </div>
                </td>
                <td class="rpm416-td-leftalign">
                  <div>Analog current (Channel 11):</div>
                  <div>
                    <div class="rpm416-valuebar rpm416-valuebar-short" value="0">
                      <div class="valuevar-inner bg-success"></div>
                    </div>
                    <span class="rpm416-text-value rpm416-text-value-right-inline" id="rpm416-analog-amperage">0</span>
                  </div>
                  <div>
                    <span class="rpm416-text-key">User scale:</span>
                    <span class="rpm416-text-value rpm416-text-value-right-inline"
                      id="rpm416-analog-amperage-userscale">0</span>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
          <table class="rpm416-grouping-table">
            <tbody>
              <tr>
                <td class="rpm416-td-leftalign">
                  Current (Channel 7):
                  <div class="rpm416-valuebar rpm416-valuebar-short" value="0">
                    <div class="valuevar-inner bg-success"></div>
                  </div>
                  <span class="rpm416-text-value rpm416-text-value-right-inline" id="rpm416-amperage-rms">0</span>
                  <div>
                    <span class="rpm416-text-key">THDr:</span>
                    <span class="rpm416-text-value rpm416-text-value-right-inline" id="rpm416-amperage-thdr">0</span>
                    <span class="rpm416-text-key">Frequency:</span>
                    <span class="rpm416-text-value rpm416-text-value-right-inline"
                      id="rpm416-amperage-frequency">0</span>
                  </div>
                </td>
                <td rowspan="2">
                  <div>
                    <canvas id="rpm416-temperatures-graph">Your browser does not support the canvas element.</canvas>
                  </div>

                </td>
              </tr>
              <tr>
                <td>
                  <table class="rpm416-inner-table">
                    <thead>
                      <th colspan="3">
                        Digital inputs (channels 12&mdash;15)
                      </th>
                    </thead>
                    <tbody>
                      <tr>
                        <td>
                          <div><span class="rpm416-text-key">Input:</span> </div>
                          <div><span class="rpm416-text-key">1:</span> <span
                              class="rpm416-status-indicator bg-danger"></span>
                          </div>
                          <div><span class="rpm416-text-key">2:</span> <span
                              class="rpm416-status-indicator bg-danger"></span>
                          </div>
                          <div><span class="rpm416-text-key">3:</span> <span
                              class="rpm416-status-indicator bg-danger"></span>
                          </div>
                          <div><span class="rpm416-text-key">4:</span> <span
                              class="rpm416-status-indicator bg-danger"></span>
                          </div>
                        </td>
                        <td>
                          <div><span class="rpm416-text-key">Imp/min:</span> </div>
                          <div><span class="rpm416-text-value" id="rpm416-impuls-frequency-1">0</span></div>
                          <div><span class="rpm416-text-value" id="rpm416-impuls-frequency-2">0</span></div>
                          <div><span class="rpm416-text-value" id="rpm416-impuls-frequency-3">0</span></div>
                          <div><span class="rpm416-text-value" id="rpm416-impuls-frequency-4">0</span></div>
                        </td>
                        <td>
                          <div><span class="rpm416-text-key">Counter:</span> </div>
                          <div><span class="rpm416-text-value" id="rpm416-impuls-counter-1">0</span></div>
                          <div><span class="rpm416-text-value" id="rpm416-impuls-counter-2">0</span></div>
                          <div><span class="rpm416-text-value" id="rpm416-impuls-counter-3">0</span></div>
                          <div><span class="rpm416-text-value" id="rpm416-impuls-counter-4">0</span></div>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </td>
              </tr>
            </tbody>
          </table>

          <table class="rpm416-grouping-table">
            <tbody>
              <tr>
                <td>
                  <span class="rpm416-text-key" id="rpm416-memory-card-state">-</span>
                </td>
                <td rowspan="2">
                  <div>
                    Status and control
                  </div>
                  <div>
                    <span class="rpm416-text-key">Errors present:</span>
                    <div class="rpm416-valuebar rpm416-valuebar-short" value="0">
                      <div class="valuevar-inner bg-success"></div>
                    </div>
                  </div>
                  <div>
                    <span class="rpm416-text-key">Data recording:</span>
                    <div class="rpm416-valuebar rpm416-valuebar-short" value="0">
                      <div class="valuevar-inner bg-success"></div>
                    </div>
                  </div>

                  <div style="text-align: left;">
                    <div>
                      <span class="rpm416-text-key" style="width:80%">Software version:</span>
                      <span class="rpm416-text-value rpm416-text-value-right-inline"
                        id="rpm416-firmware-version">0</span>
                    </div>
                    <div>
                      <span class="rpm416-text-key" style="width:80%">Uptime:</span>
                      <span class="rpm416-text-value rpm416-text-value-right-inline" style="width: 60%;"
                        id="rpm416-uptime">0</span>
                    </div>
                    <div>
                      <span class="rpm416-text-key" style="width:80%">Device time:</span>
                      <span class="rpm416-text-value rpm416-text-value-right-inline" style="width: 60%;"
                        id="rpm416-device-time">0</span>
                    </div>
                  </div>

                  <div>
                    <button type="button" class="btn btn-primary btn-sm rpm416-button" style="width: 45%;"
                      disabled>Start rec.</button>
                    <button type="button" class="btn btn-primary btn-sm rpm416-button" style="width: 45%;"
                      disabled>Reset errors</button>
                  </div>
                  <div>
                    <button type="button" class="btn btn-primary btn-sm rpm416-button" style="width: 45%;" disabled>Stop
                      rec.</button>
                    <button type="button" class="btn btn-primary btn-sm rpm416-button" style="width: 45%;"
                      disabled>Restart</button>
                  </div>
                  <div>
                    <button type="button" class="btn btn-primary btn-sm rpm416-button" style="width: 45%;"
                      disabled>Memory card</button>
                  </div>
                </td>
              </tr>
              <tr>
                <td>
                  <div>Data file</div>
                  <div>
                    <span class="rpm416-text-key">File name: </span>
                    <span class="rpm416-text-value rpm416-text-value-right-inline" id="rpm416-file-id">-</span>
                  </div>
                  <div>
                    <span class="rpm416-text-key">File size: </span>
                    <span class="rpm416-text-value rpm416-text-value-right-inline" id="rpm416-file-size">-</span>
                  </div>
                </td>
              </tr>
              <tr>
                <td colspan="2">
                  <div>Events</div>
                  <div>
                    <span class="rpm416-text-key">Event counter:</span>
                    <span class="rpm416-text-value rpm416-text-value-right-inline">0</span>
                    <span class="rpm416-text-key">Last event:</span>
                    <span class="rpm416-text-value rpm416-text-value-right-inline">0</span>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>

          <table id="rpm416-errorlist-table">
            <thead>
              <colgroup>
                <col span="1" style="width: 15%">
                <col span="1" style="width: 60%">
                <col span="1" style="width: 25%">
              </colgroup>
              <tr>
                <th>
                  Code
                </th>
                <th>
                  Text
                </th>
                <th>
                  Time
                </th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </div>

    <div id="rpm416-substrate"></div>

    <div class="rpm416-popup-menu" id="rpm416-data-graphs">
      <button type="button" class="close close-button" aria-label="Close" id="rpm416-button-data-graphs-close"><span
          aria-hidden="true">&times;</span></button>

      <header class="rpm416-header">Data graphs</header>

      <div>
        <div>
          <canvas id="rpm416-history-graph">Your browser does not support the canvas element.</canvas>
        </div>

        <table id="rpm416-graph-table">
          <colgroup>
            <col span="1" style="width: 50%">
          </colgroup>
          <tbody style="text-align: center;">
            <tr>
              <td></td>
              <td><span class="rpm416-text-key">On/Off</span></td>
              <td><span class="rpm416-text-key">Channel</span></td>
              <td><span class="rpm416-text-key">Ratio</span></td>
              <td><span class="rpm416-text-key">Color</span></td>
            </tr>
            <tr>
              <td rowspan="3"> <button type="button" class="btn btn-primary btn-sm">Clear graph</button></td>
              <td><input type="checkbox" checked></td>
              <td><select>
                  <option> -select- </option>
                </select></td>
              <td><input type="number"></td>
              <td><input type="color"></td>
            </tr>
            <tr>
              <td><input type="checkbox" checked></td>
              <td><select>
                  <option> -select- </option>
                </select></td>
              <td><input type="number"></td>
              <td><input type="color"></td>
            </tr>
            <tr>
              <td><input type="checkbox" checked></td>
              <td><select>
                  <option> -select- </option>
                </select></td>
              <td><input type="number"></td>
              <td><input type="color"></td>
            </tr>
            <tr>
              <td rowspan="3">
                <input type="checkbox" id="rpm416-checkbox-graph-on-top">
                <label for="rpm416-checkbox-graph-on-top">
                  On top
                </label>
              </td>
              <td><input type="checkbox"></td>
              <td><select disabled>
                  <option> -select- </option>
                </select></td>
              <td><input type="number" disabled></td>
              <td><input type="color" disabled></td>
            </tr>
            <tr>
              <td><input type="checkbox"></td>
              <td><select disabled>
                  <option> -select- </option>
                </select></td>
              <td><input type="number" disabled></td>
              <td><input type="color" disabled></td>
            </tr>
            <tr>
              <td><input type="checkbox"></td>
              <td><select disabled>
                  <option> -select- </option>
                </select></td>
              <td><input type="number" disabled></td>
              <td><input type="color" disabled></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    var rpm416temperatureBars = (function () {
      const data = [
        { channel: 8, value: NaN },
        { channel: 9, value: NaN },
      ];

      return new Chart(
        document.querySelector("#rpm416-temperatures-graph"),
        {
          type: "bar",
          options: {
            animation: false,
            scales: {
              x: {
                ticks: {
                  callback: function (value, index, ticks) {
                    return "channel " + value;
                  },
                },
              },
              y: {
                min: -50,
                max: 110,
              }
            },
          },
          data: {
            labels: data.map(row => row.channel),
            datasets: [
              {
                label: "Temperature (Channels 8 and 9)",
                data: data.map(row => row.value)
              }
            ]
          }
        }
      );
    })();

    (function () {
      new Chart(
        document.querySelector("#rpm416-history-graph"),
        {
          type: "scatter",
          options: {
            animation: false,
            showLine: true,
            scales: {
              x: {
                min: -6,
                max: 0,
                ticks: {
                  callback: function (value, index, ticks) {
                    return value + " min";
                  },
                },
              },
              y: {
                min: 0,
                max: 1,
              }
            },
          },
          data: {
            labels: [],
            datasets: [
              {
                data: new Array(360).fill({ x: undefined, y: undefined }), // up to 6 mins if data rate is once in a second
              }
            ]
          },
        }
      );
    })();

    document.querySelector("#rpm416-button-view").addEventListener("click", function () {
      document.querySelector("#rpm416-substrate").style.display = "block";
      document.querySelector("#rpm416-data-graphs").style.display = "block";
    });

    document.querySelector("#rpm416-button-data-graphs-close").addEventListener("click", function () {
      document.querySelector("#rpm416-substrate").style.display = "none";
      document.querySelector("#rpm416-data-graphs").style.display = "none";
    });

    document.querySelector("#rpm416-substrate").addEventListener("click", function () {
      document.querySelector("#rpm416-substrate").style.display = "none";
      document.querySelector("#rpm416-data-graphs").style.display = "none";
    });
  </script>

  <!-- Registers processing -->
  <!-- Note: DEVICE_STR and DEVICE_ID should be defined externally -->
  <script type="text/javascript">
    const API_TOKEN = document.querySelector(".vis-view").getAttribute("apitoken");
    const API_BASE_URL = document.querySelector(".vis-view").getAttribute("apibaseurl");

    async function postResponse(body, url) {
      const res = await new Promise((resolve, reject) => {
        const request = new XMLHttpRequest();
        request.onload = function () {
          const data = JSON.parse(request.response);
          resolve(data);
        }

        request.onerror = function (err) {
          console.error(err);
          reject(err)
        }

        request.open("POST", url);
        request.setRequestHeader("authorization", `token ${API_TOKEN}`);
        request.setRequestHeader("Content-Type", "application/json");
        request.send(JSON.stringify(body));
      });

      return res;
    }

    async function getResponse(url) {
      const res = await new Promise((resolve, reject) => {
        const request = new XMLHttpRequest();
        request.onload = function () {
          const data = JSON.parse(request.response);
          resolve(data);
        }

        request.onerror = function (err) {
          console.error(err);
          reject(err)
        }

        request.open("GET", url);
        request.setRequestHeader("authorization", `token ${API_TOKEN}`);
        request.setRequestHeader("Content-Type", "application/json");
        request.send();
      });

      return res;
    }

    async function rawReadRegs(address, registersNum) {
      const deviceInfo = await getResponse(`${API_BASE_URL}/v1/device/${DEVICE_ID}/`);

      const body = {
        deviceModbusId: deviceInfo.modbusUnitId,
        address: address,
        kind: "holding",
        registersNum: registersNum,
        connection: {
          kind: "net-id",
          networkId: deviceInfo.netId,
        }
      };

      const res = await postResponse(body, `${API_BASE_URL}/v1/raw/read-register-group/`);
      return res;
    }

    async function readShortReg(address) {
      const regs = await rawReadRegs(address, 1);
      if (regs.ok) {
        return regs.ok[0];
      } else {
        return undefined;
      }
    }

    async function readLongReg(address) {
      const regs = await rawReadRegs(address, 2);
      if (regs.ok) {
        return ((regs.ok[0]) << 16) + regs.ok[1];
      } else {
        return undefined;
      }
    }

    async function writeRegValues(address, values) {
      const deviceInfo = await getResponse(`${API_BASE_URL}/v1/device/${DEVICE_ID}/`);

      const body = {
        deviceModbusId: deviceInfo.modbusUnitId,
        address: address,
        kind: "holding",
        value: values,
        connection: {
          kind: "net-id",
          networkId: deviceInfo.netId,
        }
      };

      const res = await postResponse(body, `${API_BASE_URL}/v1/raw/write-register-group/`);
      return res;
    }

    async function getFirmwareVersion() {
      const reg = await rawReadRegs(1, 1);
      if (reg.ok) {
        const version_major = ((reg.ok[0] & 0xff00) >> 8).toString();
        const version_minor = (reg.ok[0] & 0x00ff).toString();
        return version_major + "." + version_minor;
      } else {
        return "Error";
      }
    }
  </script>

  <!-- Registers reading in loop -->
  <script type="text/javascript">
    const mapRegisters = new Map();

    var rpm16ReadingPhase = 0;

    async function batchRegistersRead() {
      rpm16ReadingPhase++;
      rpm16ReadingPhase %= 10;
      const start = new Date();

      // State register
      mapRegisters.set(8, await readLongReg(8));

      // File identifier
      mapRegisters.set(16, await readShortReg(16));

      // File size
      mapRegisters.set(17, await readLongReg(17));

      // Uptime value
      mapRegisters.set(19, await readLongReg(19));

      // Device time
      mapRegisters.set(21, await readLongReg(21));

      mapRegisters.set(101, await readLongReg(101));
      mapRegisters.set(104, await readLongReg(104));
      mapRegisters.set(107, await readLongReg(107));
      mapRegisters.set(119, await readLongReg(119));
      mapRegisters.set(122, await readLongReg(122));
      mapRegisters.set(125, await readLongReg(125));
      mapRegisters.set(137, await readLongReg(137));
      mapRegisters.set(140, await readLongReg(140));
      mapRegisters.set(143, await readLongReg(143));
      mapRegisters.set(155, await readLongReg(155));
      mapRegisters.set(158, await readLongReg(158));
      mapRegisters.set(161, await readLongReg(161));
      mapRegisters.set(173, await readLongReg(173));
      mapRegisters.set(176, await readLongReg(176));
      mapRegisters.set(179, await readLongReg(179));
      mapRegisters.set(191, await readLongReg(191));
      mapRegisters.set(194, await readLongReg(194));
      mapRegisters.set(197, await readLongReg(197));
      mapRegisters.set(209, await readLongReg(209));
      mapRegisters.set(212, await readLongReg(212));
      mapRegisters.set(215, await readLongReg(215));

      // Temperature
      mapRegisters.set(227, await readLongReg(227));
      mapRegisters.set(245, await readLongReg(245));

      // Analog voltage & user scale
      mapRegisters.set(263, await readLongReg(263));
      mapRegisters.set(266, await readLongReg(266));

      // Analog current & user scale
      mapRegisters.set(281, await readLongReg(281));
      mapRegisters.set(284, await readLongReg(284));

      // Counters & frequencies
      mapRegisters.set(302, await readLongReg(302));
      mapRegisters.set(305, await readLongReg(305));
      mapRegisters.set(320, await readLongReg(320));
      mapRegisters.set(323, await readLongReg(323));
      mapRegisters.set(338, await readLongReg(338));
      mapRegisters.set(341, await readLongReg(341));
      mapRegisters.set(356, await readLongReg(356));
      mapRegisters.set(359, await readLongReg(359));

      // AB, BC, CA
      mapRegisters.set(425, await readLongReg(425));
      mapRegisters.set(428, await readLongReg(428));
      mapRegisters.set(431, await readLongReg(431));

      // Negative sequence, positive sequence, direct sequence
      for (let i = 0; i <= 2; i++) {
        mapRegisters.set(434 + 3 * i, await readLongReg(434 + 3 * i));
      }

      return false;
    }
  </script>

  <script>
    function updateDisplayedValue(idStr, address, decimal) {
      const value = mapRegisters.get(address);
      if (value === undefined) {
        document.querySelector("#" + idStr).innerHTML = "-";
      } else {
        if (decimal == 0 || decimal === undefined) {
          document.querySelector("#" + idStr).innerHTML = value.toString();
        } else if (decimal == 1) {
          document.querySelector("#" + idStr).innerHTML = (value * 0.1).toFixed(1);
        } else if (decimal == 2) {
          document.querySelector("#" + idStr).innerHTML = (value * 0.01).toFixed(2);
        }
      }
    }

    function updateDisplayedUptime() {
      const value = mapRegisters.get(19);
      if (value === undefined) {
        document.querySelector("#rpm416-uptime").innerHTML = "undefined";
      } else {
        const days = (value / 86400).toFixed(0);

        const hours = (value % 86400) / 3600;
        const hh = hours < 10 ? "0" + hours.toFixed(0) : hours.toFixed(0);

        const minutes = (value % 3600) / 60;
        const mm = minutes < 10 ? "0" + minutes.toFixed(0) : minutes.toFixed(0);

        const seconds = value % 60;
        const ss = seconds < 10 ? "0" + seconds.toFixed(0) : seconds.toFixed(0);
        document.querySelector("#rpm416-uptime").innerHTML = days + " days " + hh + ":" + mm + ":" + ss;
      }
    }

    function updateDisplayedDeviceTime() {
      const value = mapRegisters.get(21);
      if (value === undefined) {
        document.querySelector("#rpm416-device-time").innerHTML = "undefined";
      } else {
        const startdate = new Date(1980, 1, 1, 0, 0, 0);
        const currentdate = (new Date(startdate.valueOf() + value * 1000)).toLocaleString();
        document.querySelector("#rpm416-device-time").innerHTML = currentdate;
      }
    }

    function updateDisplayedSDCardState() {
      const value = mapRegisters.get(8);
      if (value === undefined) {
        document.querySelector("#rpm416-memory-card-state").innerHTML = "-";
      } else {
        const state = value & (1<<4);
        console.log(state);
        if (state == 0) {
          document.querySelector("#rpm416-memory-card-state").innerHTML = "No memory card installed";
        } else if (state == 1) {
          document.querySelector("#rpm416-memory-card-state").innerHTML = "Memory card installed";
        } else {
          document.querySelector("#rpm416-memory-card-state").innerHTML = "An error occured!";
          console.error("impossible state value");
        }
      }
    }

    function updateDisplayedFileName() {
      const id = mapRegisters.get(16);
      if (id === undefined) {
        document.querySelector("#rpm416-file-id").innerHTML = "-";
      } else {
        let id_str = "";

        if (id < 0) {
          document.querySelector("#rpm416-file-id").innerHTML = "An error occured";
          console.error("File number is beyond allowable range:", id);
        } else if (id < 10) {
          id_str = "000" + id.toString();
        } else if (id < 100) {
          id_str = "00" + id.toString();
        } else if (id < 1000) {
          id_str = "0" + id.toString();
        } else if (id < 10000) {
          id_str = id.toString();
        } else {
          document.querySelector("#rpm416-file-id").innerHTML = "An error occured";
          console.error("File number is beyond allowable range:", id);
        }

        document.querySelector("#rpm416-file-id").innerHTML = "FILE" + id_str + ".RDF";
      }
    }

    function updateDisplayedFileSize() {
      const filesize = mapRegisters.get(17);
      if (filesize === undefined) {
        document.querySelector("#rpm416-file-size").innerHTML = "-"
      } else {
        document.querySelector("#rpm416-file-size").innerHTML = filesize.toString() + " bytes";
      }
    }
  </script>

  <!-- Thread loop -->
  <script>
    var rpm416ReadLock = false;

    getFirmwareVersion().then((value) => {
      document.querySelector("#rpm416-firmware-version").innerHTML = value;
    });

    async function updateValuesOnVis() {
      if (!rpm416ReadLock) {
        rpm416ReadLock = true;
        rpm416ReadLock = await batchRegistersRead();
      }

      updateDisplayedUptime();
      updateDisplayedDeviceTime();
      updateDisplayedSDCardState();
      updateDisplayedFileName();
      updateDisplayedFileSize();
      updateDisplayedValue("rpm416-negative-sequence-value", 434, 1);
      updateDisplayedValue("rpm416-positive-sequence-value", 437, 1);
      updateDisplayedValue("rpm416-zero-sequence-value", 440, 1);
      updateDisplayedValue("rpm416-voltage-rms-1", 101, 1);
      updateDisplayedValue("rpm416-voltage-thdr-1", 107, 0);
      updateDisplayedValue("rpm416-voltage-frequency-1", 104, 2);
      updateDisplayedValue("rpm416-voltage-rms-2", 119, 1);
      updateDisplayedValue("rpm416-voltage-thdr-2", 125, 0);
      updateDisplayedValue("rpm416-voltage-frequency-2", 122, 2);
      updateDisplayedValue("rpm416-voltage-rms-3", 137, 1);
      updateDisplayedValue("rpm416-voltage-thdr-3", 143, 0);
      updateDisplayedValue("rpm416-voltage-frequency-3", 140, 2);
      updateDisplayedValue("rpm416-amperage-rms-1", 155, 1);
      updateDisplayedValue("rpm416-amperage-thdr-1", 161, 0);
      updateDisplayedValue("rpm416-amperage-frequency-1", 158, 2);
      updateDisplayedValue("rpm416-amperage-rms-2", 173, 1);
      updateDisplayedValue("rpm416-amperage-thdr-2", 179, 0);
      updateDisplayedValue("rpm416-amperage-frequency-2", 176, 2);
      updateDisplayedValue("rpm416-amperage-rms-3", 191, 1);
      updateDisplayedValue("rpm416-amperage-thdr-3", 197, 0);
      updateDisplayedValue("rpm416-amperage-frequency-3", 194, 2);
      updateDisplayedValue("rpm416-voltage-line-ab", 425, 1);
      updateDisplayedValue("rpm416-voltage-line-bc", 428, 1);
      updateDisplayedValue("rpm416-voltage-line-ca", 431, 1);
      updateDisplayedValue("rpm416-analog-voltage", 263, 2);
      updateDisplayedValue("rpm416-analog-amperage", 281, 2);
      updateDisplayedValue("rpm416-analog-voltage-userscale", 266, 2);
      updateDisplayedValue("rpm416-analog-amperage-userscale", 284, 2);
      updateDisplayedValue("rpm416-amperage-rms", 209, 2);
      updateDisplayedValue("rpm416-amperage-thdr", 215, 0);
      updateDisplayedValue("rpm416-amperage-frequency", 212, 2);
      updateDisplayedValue("rpm416-impuls-frequency-1", 302, 1);
      updateDisplayedValue("rpm416-impuls-counter-1", 305, 0);
      updateDisplayedValue("rpm416-impuls-frequency-2", 320, 1);
      updateDisplayedValue("rpm416-impuls-counter-2", 323, 0);
      updateDisplayedValue("rpm416-impuls-frequency-3", 338, 1);
      updateDisplayedValue("rpm416-impuls-counter-3", 341, 0);
      updateDisplayedValue("rpm416-impuls-frequency-4", 356, 1);
      updateDisplayedValue("rpm416-impuls-counter-4", 359, 0);

      rpm416temperatureBars.data.datasets[0].data[0] = mapRegisters.get(227) * 0.1;
      rpm416temperatureBars.data.datasets[0].data[1] = mapRegisters.get(245) * 0.1;
    }

    setInterval(updateValuesOnVis, UPDATE_VISUALIZATION_INTERVAL_MS);
  </script>
</div>